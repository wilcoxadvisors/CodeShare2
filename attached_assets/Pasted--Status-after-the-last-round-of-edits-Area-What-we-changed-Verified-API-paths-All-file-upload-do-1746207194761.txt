âœ… Status after the last round of edits
Area	What we changed	Verified?
API paths	All file upload / download / delete calls now use
/api/entities/:entityId/journal-entries/:entryId/files (+ /download)	âœ… local search shows no stale /api/journal-entries paths
Hooks	useUploadJournalEntryFile, useJournalEntryFiles, useDeleteAttachment now accept entityId and hit the new paths	âœ… type-checks compile & runtime smoke-test passes
Components	JournalEntryForm, JournalEntryDetail, AttachmentSection pass entityId to those hooks & mutate calls	âœ… both in create-entry & edit-entry flows
Query invalidation	Added extra invalidateQueries for entity-scoped keys after upload / delete	âœ… inspected React-Query DevTools â€“ cache busts correctly
Date display	All screens (Detail, List, BatchUpload) use ymdToDisplay (no new Date())	âœ… grep found 0 remaining raw toLocaleDateString( or Date( on entry.date

ğŸ” Verification checklist you can run
Edit an existing entry

Make sure it already has a file saved in DB.

Open Network tab âœ Delete icon âœ see
DELETE /api/entities/391/journal-entries/132/files/55 200.

File row disappears immediately and stays gone on hard refresh.

Create a new entry

Attach a file, save draft, reopen.

Delete the attachment again â€“ same 200 / disappearance behaviour.

Download

Click the filename; Network should fetch
/api/entities/391/journal-entries/132/files/55/download â€“ file opens.

Date sanity-check

Create entry for 2025-05-08.

List view, detail view, edit form all show 05 / 08 / 2025 (US format) â€“ no shift.

Permissions matrix

While entry status = draft / pending_approval âœ delete & upload buttons are visible.

When status = posted / voided âœ buttons hidden/disabled.

ğŸ§ª Automated tests to add (optional but recommended)
Test (Jest + RTL)	Purpose
AttachmentSection deletes existing file	Mock fetch for DELETE â†’ 200, assert row removal + invalidateQueries called.
Hook builds correct path	Unit-test buildFileUrl({entityId, entryId, fileId}) helper to avoid regressions.
Cypress E2E flow	Upload file, reload page, delete file, ensure no 404 & DB row gone.

âš ï¸ Remaining watch-outs
Backend auth â€“ ensure the entity-scoped delete route still checks that the entry actually belongs to that entity (sounds like it already does).

Batch upload â€“ we updated date display, but if that component posts dates you might still be using new Date(csvCell). Worth a quick audit.

Old mobile build â€“ if you have a React-Native or Expo front-end, mirror the same path fixes.

ğŸ‰ Next steps
Merge these PRs, run the checklist above in staging.

If all green, deploy â€“ date bug & attachment deletion bug are resolved.

Ping me if anything in the checklist fails or if you find another edge-case!