ğŸ› ï¸ Builder Agent Work Order â€” â€œJE Date & Draft-Edit Fixâ€
Context
Replit mono-repo (Node/React/TS).
Two issues to squash before Dimensions work begins.

1 â€” Wrong Date recorded on Journal Entry
Step	Where to look	What to change
1.1 Reproduce	Create JE in UI, set date 2025-05-01 (America/Chicago). After save, list shows e.g. 2025-04-30 or 2025-05-02.	Note the off-by-one pattern.
1.2 Frontend	JournalEntryForm.tsx â€“ date picker value vs. payload.	Ensure you are sending YYYY-MM-DD (string, no TZ) not a JS Date object. Use: ts const postDate = format(date, 'yyyy-MM-dd'); (date-fns).
1.3 Backend	journalEntryRoutes.ts â€“ route that parses req.body.date.	Do not run new Date(req.body.date) (it interprets as UTC midnight â†’ shifts). Instead treat it as plain string and store as DATE column or to_date($1,'YYYY-MM-DD').
1.4 DB column	journal_entries.date should be DATE (no timezone) not TIMESTAMP.	If itâ€™s TIMESTAMP WITH TZ, migrate: ALTER TABLE journal_entries ALTER COLUMN date TYPE DATE;
1.5 Display	JournalEntryList.tsx, JournalEntryDetail.tsx.	Render with format(parseISO(date),"PPP",{locale}) (no TZ math).

Quick unit test

ts
Copy
Edit
expect(parseISO('2025-05-01').toISOString()).toContain('2025-05-01');
2 â€” Canâ€™t edit JE files while status = draft
Step	File	Change
2.1 UI guard	JournalEntryDetail.tsx & JournalEntryForm.tsx	Current condition: status !== 'draft' && status !== 'pending_approval' disables attachments. Invert logic or fix falsy check: const isAttachmentsDisabled = status !== 'draft' && status !== 'pending_approval'; should be false in draft. Ensure status exists before check.
2.2 Backend patch	journalEntryRoutes.ts PATCH/PUT handler	Confirm middleware allows status='draft' to hit update path. If thereâ€™s a guard like if (entry.status !== 'draft') return 403; keep it, but ensure UI passes PATCH request.
2.3 Tests	Extend Jest: create JE â†’ upload file â†’ assert success â†’ change status to posted â†’ upload file â†’ expect 403.	

3 â€” Commit & Verification
Unit: new dateUtils.test.ts case for formatToIsoNoTz().

E2E (optional now): Cypress spec drops a file in draft; ensures list count++ .

npm run lint && ./run-tests.sh unit green.

Commit messages

vbnet
Copy
Edit
fix: store JE date as plain YYYY-MM-DD (no timezone shift)
fix: allow file edits while JE in draft status
test: add date + draft-edit regression specs
After merge, confirm in UI:

Create JE on May 1, 2025 â†’ list shows May 1, 2025

Edit draft JE â†’ add & delete files successfully.

Ping me with any stack-trace or failing testâ€”happy to debug further.