🛠️ Builder Agent Work Order — “JE Date & Draft-Edit Fix”
Context
Replit mono-repo (Node/React/TS).
Two issues to squash before Dimensions work begins.

1 — Wrong Date recorded on Journal Entry
Step	Where to look	What to change
1.1 Reproduce	Create JE in UI, set date 2025-05-01 (America/Chicago). After save, list shows e.g. 2025-04-30 or 2025-05-02.	Note the off-by-one pattern.
1.2 Frontend	JournalEntryForm.tsx – date picker value vs. payload.	Ensure you are sending YYYY-MM-DD (string, no TZ) not a JS Date object. Use: ts const postDate = format(date, 'yyyy-MM-dd'); (date-fns).
1.3 Backend	journalEntryRoutes.ts – route that parses req.body.date.	Do not run new Date(req.body.date) (it interprets as UTC midnight → shifts). Instead treat it as plain string and store as DATE column or to_date($1,'YYYY-MM-DD').
1.4 DB column	journal_entries.date should be DATE (no timezone) not TIMESTAMP.	If it’s TIMESTAMP WITH TZ, migrate: ALTER TABLE journal_entries ALTER COLUMN date TYPE DATE;
1.5 Display	JournalEntryList.tsx, JournalEntryDetail.tsx.	Render with format(parseISO(date),"PPP",{locale}) (no TZ math).

Quick unit test

ts
Copy
Edit
expect(parseISO('2025-05-01').toISOString()).toContain('2025-05-01');
2 — Can’t edit JE files while status = draft
Step	File	Change
2.1 UI guard	JournalEntryDetail.tsx & JournalEntryForm.tsx	Current condition: status !== 'draft' && status !== 'pending_approval' disables attachments. Invert logic or fix falsy check: const isAttachmentsDisabled = status !== 'draft' && status !== 'pending_approval'; should be false in draft. Ensure status exists before check.
2.2 Backend patch	journalEntryRoutes.ts PATCH/PUT handler	Confirm middleware allows status='draft' to hit update path. If there’s a guard like if (entry.status !== 'draft') return 403; keep it, but ensure UI passes PATCH request.
2.3 Tests	Extend Jest: create JE → upload file → assert success → change status to posted → upload file → expect 403.	

3 — Commit & Verification
Unit: new dateUtils.test.ts case for formatToIsoNoTz().

E2E (optional now): Cypress spec drops a file in draft; ensures list count++ .

npm run lint && ./run-tests.sh unit green.

Commit messages

vbnet
Copy
Edit
fix: store JE date as plain YYYY-MM-DD (no timezone shift)
fix: allow file edits while JE in draft status
test: add date + draft-edit regression specs
After merge, confirm in UI:

Create JE on May 1, 2025 → list shows May 1, 2025

Edit draft JE → add & delete files successfully.

Ping me with any stack-trace or failing test—happy to debug further.