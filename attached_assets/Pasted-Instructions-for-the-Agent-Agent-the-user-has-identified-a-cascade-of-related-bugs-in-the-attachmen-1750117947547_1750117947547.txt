Instructions for the Agent
Agent, the user has identified a cascade of related bugs in the attachment and editing workflow. The root cause is a combination of incorrect navigation, incomplete data-flow (prop drilling), and improper cache invalidation.

You will now execute a final, three-part mission to make this module production-ready.

Part 1: Fix Navigation Bug

File to Modify: client/src/features/journal-entries/pages/JournalEntryDetail.tsx
Action: Locate the onClick handler for the "Edit" button.
Required Logic Change: The Maps(...) call is using a broken, non-hierarchical URL. You must correct it to build the full, proper URL, including the current clientId and entityId.
Correct URL Structure: /clients/${clientId}/entities/${entityId}/journal-entries/${entryId}/edit
Part 2: Fix Attachment Data Flow

File to Modify: client/src/features/journal-entries/components/JournalEntryForm.tsx
Action: You must ensure the files array is correctly passed down to the AttachmentSection.
Required Logic Change:
The JournalEntryForm component receives the existingEntry prop.
Find where <AttachmentSection /> is rendered within the form.
Ensure you are passing the attachments prop correctly, like so: attachments={existingEntry?.files || []}.
Also, ensure you are passing the status and a boolean for isInEditMode, as the agent correctly identified in the last run.
Part 3: Fix Stale Data & Cache Invalidation

File to Modify: client/src/features/journal-entries/hooks/attachmentQueries.ts
Action: You will fix the onSuccess handlers for both the upload and delete mutations.
Required Logic Change for useDeleteJournalEntryFile:
In the onSuccess handler, you must invalidate two queries:
The specific query for the attachment list: queryClient.invalidateQueries({ queryKey: ['journalEntryAttachments', variables.journalEntryId], exact: true });
The main query for the journal entry itself, to update its internal files array: queryClient.invalidateQueries({ queryKey: [getJournalEntryUrl(variables.clientId, variables.entityId, variables.journalEntryId)] });
Required Logic Change for useUploadJournalEntryFiles:
Apply the exact same two-part invalidation logic to its onSuccess handler.
Please execute this complete, three-part plan. Start with Part 1. These changes will resolve the navigation error, ensure attachments are always visible, and fix the stale data issue