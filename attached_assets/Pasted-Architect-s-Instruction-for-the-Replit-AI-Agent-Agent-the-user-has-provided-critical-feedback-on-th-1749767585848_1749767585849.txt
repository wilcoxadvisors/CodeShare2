Architect's Instruction for the Replit AI Agent
Agent, the user has provided critical feedback on the Master Upload feature. The current implementation is incomplete. We will now refactor it to match the functionality of the COA import.

This will be a multi-phase operation. We will start with the most critical logic fix on the backend.

Phase 1: Fix the "Update" and "Delete" Logic
Goal: Refactor the backend analysis endpoint to correctly identify what has actually changed and to support deletions.

File to Modify: server/routes/dimensionRoutes.ts

Action: In the POST /api/clients/:clientId/master-values-upload route handler, you must significantly enhance the row-processing logic.

New CSV Format: The master template and upload process must now support an action column. The CSV headers should be: dimension_code, value_code, value_name, value_description, is_active, action. The action column can contain CREATE, UPDATE, or DELETE.

Updated Analysis Logic:

For each row in the CSV:
If action is DELETE: Add the row to a toDelete array in the preview.
If action is UPDATE (or blank/null):
Find the existing value in the database.
Compare every field (value_name, value_description, is_active).
Only if one or more fields have actually changed should you add the row to the toUpdate array in the preview.
If no fields have changed, add the row to a new unchanged array.
If action is CREATE: Add the row to the toCreate array.
Updated API Response: The JSON response from this endpoint must now be even more detailed:
JSON

{
  "preview": {
    "toCreate": [...],
    "toUpdate": [...],
    "toDelete": [...],
    "unchanged": [...],
    "errors": [...]
  }
}
Phase 2: Frontend UX Improvements
(To be performed after the backend logic in Phase 1 is complete)

File to Modify: client/src/pages/manage/DimensionsPage.tsx
Action for Upload UX:
Change the "Upload Master CSV" button so it directly opens the file selection dialog.
When a file is selected, the onChange event of the file input should immediately trigger the upload and analysis mutation. This removes the need for a second click.
Action for Preview UI:
The preview table must be updated to display the new toDelete and unchanged categories, with appropriate icons and styling.
The user should be able to select/deselect items from the toCreate, toUpdate, and toDelete lists for processing.
Agent, please begin with Phase 1: Modifying the backend analysis endpoint to support the action column and to correctly identify true updates versus unchanged rows.