📜 Updated Work-Plan & Ground-Rules for the Dev Agent
Prime Directive:
1️⃣ Finish the Journal-Entry (JE) feature to production quality – including files, dates, permissions, and the new canonical URL scheme.
2️⃣ Add “Dimensions” support (master-data + optional fields on JE lines).
3️⃣ Deliver batch-upload tooling that understands dimensions.
Re-work only once; lock conventions now.

1 • Journal-Entry Finalisation (🔝 PRIORITY)
Step	What to do	Done when
1.1	Adopt the full hierarchy route everywhere:
/api/clients/:clientId/entities/:entityId/journal-entries/:jeId/files (+download/delete)	All FE hooks, components & BE controllers use helper functions, no string-concat. Old routes return 302 with Deprecation header.
1.2	Create src/api/urlHelpers.ts (see previous message). Use exclusively.	No hard-coded paths survive. ESLint rule added to forbid /journal-entries/ literals.
1.3	Refactor attachment hooks
useJournalEntryFiles, useUploadJournalEntryFile, useDeleteJournalEntryFile to take { clientId, entityId, jeId }.	✅ Unit tests hit the new path.
1.4	Update JE UI (Form + Detail) to pass the three IDs, show list, allow upload, download, delete.	Manual smoke test: create JE with file, reload, edit, delete – all works.
1.5	Server
• Add/verify Express/Laravel/etc. routes for new path.
• Middleware validates client-entity linkage.
• Return 400 on mismatch.	Postman tests green.
1.6	Automated tests
• E2E Cypress: JE create→attach→edit→delete.
• Jest/RTL unit tests for urlHelpers.	Pipeline green.

When 1.1-1.6 are ✅ we freeze JE schema & routes.

2 • Introduce “Dimensions”
Schema:

sql
Copy
Edit
dimensions(id PK, client_id FK, entity_id FK, code, name, active, …)
API:

GET /api/clients/:cId/entities/:eId/dimensions

POST /api/…/dimensions (CRUD)

JE Line model:

Add nullable dimensionId.

Back-fill existing lines with NULL.

UI:

In JE line-edit row show Dimension select (optional, filtered by entity).

Validation: if provided, must belong to same client & entity.

Migrations & tests.

3 • Batch Upload (CSV/XLSX) with Dimensions
Step	Description
3.1	Drop-zone UI → parse via papaparse / xlsx.
3.2	Mapping screen (columns ↔ fields incl. dimension).
3.3	Server endpoint /api/clients/:cId/entities/:eId/journal-entries/batch accepts array of JE objects.
3.4	Validates, returns preview diff; client confirms → commit.
3.5	Error report downloadable (CSV).

4 • Process & Quality Rules (apply to all future work)
Single source of truth helpers for every route segment – never duplicate.

Write the ADR first, commit docs/adr/nnn-route-hierarchy.md.

Tests before merge – unit + E2E covering happy path and failure modes.

Conventional Commits (feat: add dimensions API, fix: JE file upload path).

Auto-formatted (prettier --check in CI).

No console.log in prod – use debug or logger.

What’s “MVP” again?
Minimum Viable Product – the leanest slice that solves a real user need and can be shipped quickly.
Here: MVP = fully functional Journal Entry with files & dates using the new route scheme.

Ready to execute?
If these instructions line up with your expectations, I’ll start at 1.1 immediately and keep you posted PR-by-PR.